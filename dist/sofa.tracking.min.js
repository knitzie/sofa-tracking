/**
 * sofa-tracking - v0.4.0 - 2014-07-14
 * http://www.sofa.io
 *
 * Copyright (c) 2014 CouchCommerce GmbH (http://www.couchcommerce.com / http://www.sofa.io) and other contributors
 * THIS SOFTWARE CONTAINS COMPONENTS OF THE SOFA.IO COUCHCOMMERCE SDK (WWW.SOFA.IO).
 * IT IS PROVIDED UNDER THE LICENSE TERMS OF THE ATTACHED LICENSE.TXT.
 */
!function(a){"use strict";a.define("sofa.tracking.BingTracker",function(a){var b={};return b.setup=function(){},b.trackEvent=function(){},b.trackAction=function(){},b.trackTransaction=function(b){var c="//flex.msn.com/mstag/tag/"+a.siteId+"/analytics.html?dedup="+(a.dedup||"1")+"&domainId="+a.domainId+"&type="+(a.type||"1")+"&revenue="+b.totals.subtotal+"&actionid="+a.actionId,d=new Image(1,1);d.src=c},b}),a.define("sofa.tracking.GoogleAnalyticsTracker",function(a){var b={};return b.setup=function(){var c=b._gaq=window._gaq=window._gaq||[];c.push(["_setAccount",a.accountNumber]),c.push(["_setDomainName",a.domainName]),c.push(["_setAllowLinker",!0]);var d=document.createElement("script");d.type="text/javascript",d.async=!0,d.src=("https:"===document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(d,e)},b.trackEvent=function(a){a.category=a.category||"",a.action=a.action||"",a.label=a.label||"",a.value=a.value||"";var b=[];"pageView"===a.category?(b.push("_trackPageview"),b.push(a.label)):(b.push("_trackEvent"),b.push(a.category),b.push(a.action),b.push(a.label),a.value&&b.push(a.value)),_gaq.push(b)},b.trackAction=function(){},b.trackTransaction=function(b){if(a.conversionId){var c="http://www.googleadservices.com/pagead/conversion/"+a.conversionId+"/?value="+b.totals.subtotal+"&label="+a.conversionLabel+"&guid=ON&script=0",d=new Image(1,1);d.src=c}_gaq.push(["_gat._anonymizeIp"]),_gaq.push(["_addTrans",b.token,location.host,b.totals.subtotal,b.totals.vat,b.totals.shipping,"","",b.billing.countryname]),b.items.forEach(function(a){_gaq.push(["_addItem",b.token,a.productId,a.name,"",a.price,a.qty])}),_gaq.push(["_trackTrans"])},b}),a.define("sofa.tracking.MixpanelTracker",function(a){var b={};return b.setup=function(){!function(a,b){if(!b.__SV){var c,d,e,f;window.mixpanel=b,b._i=[],b.init=function(a,c,d){function g(a,b){var c=b.split(".");2==c.length&&(a=a[c[0]],b=c[1]),a[b]=function(){a.push([b].concat(Array.prototype.slice.call(arguments,0)))}}var h=b;for("undefined"!=typeof d?h=b[d]=[]:d="mixpanel",h.people=h.people||[],h.toString=function(a){var b="mixpanel";return"mixpanel"!==d&&(b+="."+d),a||(b+=" (stub)"),b},h.people.toString=function(){return h.toString(1)+".people (stub)"},e="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.track_charge people.clear_charges people.delete_user".split(" "),f=0;f<e.length;f++)g(h,e[f]);b._i.push([a,c,d])},b.__SV=1.2,c=a.createElement("script"),c.type="text/javascript",c.async=!0,c.src="//cdn.mxpnl.com/libs/mixpanel-2.2.min.js",d=a.getElementsByTagName("script")[0],d.parentNode.insertBefore(c,d)}}(document,window.mixpanel||[]),window.mixpanel.init(a.token)},b.trackAction=function(b,c){c["Store Name"]=a.storePath,window.mixpanel.track(b,c)},b.trackEvent=function(){},b.trackTransaction=function(){},b}),a.define("sofa.tracking.TrackingService",function(b,c,d){var e={},f=e.__trackers=[];return a.observable.mixin(e),e.addTracker=function(a){if(!a.setup)throw new Error("tracker must implement a setup method");if(!a.trackEvent)throw new Error("tracker must implement a trackEvent method");if(!a.trackAction)throw new Error("tracker must implement a trackAction method");if(!a.trackTransaction)throw new Error("tracker must implement a trackTransaction method");a.setup(),f.push(a)},e.trackEvent=function(a){e.emit("trackEvent",e,a),f.forEach(function(b){b.trackEvent(a)})},e.trackAction=function(a,b){e.emit("trackAction",e,a,b),f.forEach(function(c){c.trackAction(a,b)})},e.trackTransaction=function(b){var g=d.get("checkoutUrl")+"summaryfin.php";c.get(g+"?token="+b+"&details=get").then(function(c){var d=a.Util.toJson(c.data);d.token=b,e.emit("trackTransaction",e,d),f.forEach(function(a){a.trackTransaction(d)})})},e})}(sofa);